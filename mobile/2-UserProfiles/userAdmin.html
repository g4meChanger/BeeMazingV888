<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Task Review</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">







  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

:root {
    --primary-color: #FFC107;
    --secondary-color: #212121;
    --accent-color: #FFFFFF;
    --light-bg: #1E1F26;
    --text-color: #FFFFFF;
    --footer-height: 70px;
    --modal-bg: rgba(33, 33, 33, 0.7); /* Added */
    --border-dark: #444754; /* Added */
}

#taskContainer {
  margin-top: 130px;
  padding-bottom: 80px;
}


    body {
      font-family: 'Poppins', sans-serif;
      background-color: #1E1F26;
      color: #FFFFFF;
      margin: 0;
      padding: 0;
    }

    .header {
    background: linear-gradient(135deg, var(--primary-color), #FFB300);
    padding: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    position: fixed;
    top: 0;
    width: 100%;
    height: var(--header-height);
    z-index: 100;
}

    .date-header {
    background: var(--secondary-color);
    position: fixed;
    top: 0;
    width: 100%;
    z-index: 50;
    padding: 5px 0;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
}
    .month-nav {
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 18px;
        font-weight: bold;
        width: 100%;
        padding: 5px 0;
    }
    .month-nav button {
      margin: 0 10px;
      background: #FFC107;
      color: #212121;
      border: none;
      padding: 5px 10px;
      border-radius: 6px;
      cursor: pointer;
    }
    .month-nav button:hover {
      background: #FFD54F;
    }
    .day-scroll-wrapper {
      display: flex;
      align-items: center;
      padding: 5px 0;
      overflow: hidden;
    }
    .scroll-btn {
      background: #212121;
      color: #fff;
      border: none;
      font-size: 20px;
      padding: 5px 10px;
      cursor: pointer;
    }
    .day-scroll {
      display: flex;
      overflow-x: auto;
      gap: 8px;
      padding: 5px 10px;
    }
    .day {
      min-width: 38px;
      height: 38px;
      line-height: 38px;
      text-align: center;
      border-radius: 50%;
      background: #333;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
    }
    .day.selected {
      background: #FFC107;
      color: #212121;
    }
    .task-entry {
      background: #2A2B32;
      border: 2px solid #444754;
      border-radius: 12px;
      padding: 16px;
      margin: 15px;
      cursor: pointer;
    }
    .task-entry:hover {
      background: #333540;
    }
    .task-title {
      margin: 0;
      font-weight: bold;
      display: flex;
      align-items: center;
    }
    .notification-bubble {
      background: #D32F2F;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      line-height: 20px;
      text-align: center;
      font-size: 12px;
      margin-left: 10px;
    }
    .task-details {
      display: none;
      margin-top: 10px;
    }
    .task-details.show {
      display: block;
    }
    .turn-entry {
  background: #3A3B44;
  border-radius: 8px;
  padding: 10px;
  margin: 5px 0;
  border: 2px solid transparent;
}
    .turn-entry p {
      margin: 5px 0;
    }
    .accept-btn, .decline-btn, .replace-btn, .revert-btn {
      margin-top: 10px;
      padding: 8px 14px;
      font-weight: bold;
      border-radius: 6px;
      border: none;
      cursor: pointer;
    }
    .accept-btn {
      background-color: #4CAF50;
      color: white;
      margin-right: 10px;
    }
    .decline-btn {
      background-color: #D32F2F;
      color: white;
    }
    .replace-btn {
      background-color: #2196F3;
      color: white;
      margin-right: 10px;
    }
    .revert-btn {
      background-color: #FF9800;
      color: white;
    }
    select {
      padding: 8px;
      border-radius: 6px;
      background: #333;
      color: #fff;
      border: 1px solid #444754;
      margin-top: 10px;
    }
    .day-scroll::-webkit-scrollbar {
      display: none;
    }
    .day-scroll {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }


    .footer {
    position: fixed;
    bottom: 0;
    width: 100%;
    display: flex;
    justify-content: space-around;
    align-items: center;
    background: var(--secondary-color);
    padding: 10px 0;
    box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.2);
    z-index: 100;
    height: var(--footer-height);
}
.footer a {
    text-decoration: none;
    color: var(--text-color);
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: transform 0.3s ease;
}
.footer a:hover {
    transform: scale(1.1);
}
.footer-icon img {
    width: 40px;
    height: 40px;
    filter: invert(100%) drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
}
.footer a.active img {
    filter: invert(77%) sepia(88%) saturate(900%) hue-rotate(0deg)
        brightness(100%) contrast(100%) drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2)) !important;
}
.footer-icon span {
    font-size: 12px;
    margin-top: 5px;
    font-weight: 600;
}
.footer a.active span {
    color: var(--primary-color);
}
@media (max-width: 600px) {
    .footer-icon img {
        width: 35px;
        height: 35px;
    }
}














/* Profile Icon */
.profile-icon {
    position: fixed;
    top: 10px;
    right: 20px;
    width: 40px;
    height: 40px;
    cursor: pointer;
    z-index: 202;
    transition: transform 0.3s ease;
    filter: invert(100%) brightness(200%);
}

.profile-icon:hover {
    transform: scale(1.1);
}














/* Right top corner Select User Menu ********************************************************/
.bottom-sheet {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--modal-bg);
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.3s ease-in-out;
}
.bottom-sheet.show {
    display: block;
    opacity: 1;
}
.bottom-sheet-content {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    max-height: 70vh;
    background: #2A2B32;
    border-top-left-radius: 20px;
    border-top-right-radius: 20px;
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.5);
    transform: translateY(100%);
    transition: transform 0.3s ease-in-out;
}
.bottom-sheet.show .bottom-sheet-content {
    transform: translateY(0);
}
.bottom-sheet-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    border-bottom: 1px solid var(--border-dark);
}
.bottom-sheet-header h3 {
    margin: 0;
    font-size: 18px;
    font-weight: 600;
    color: var(--text-color);
}
.bottom-sheet-header .close-btn {
    background: none;
    border: none;
    color: var(--text-color);
    font-size: 24px;
    cursor: pointer;
    padding: 5px;
}
.bottom-sheet-header .close-btn:hover {
    color: var(--primary-color);
}
.user-list {
    list-style: none;
    padding: 0;
    margin: 0;
    height: 240px; /* Approx. 5 users at 48px each */
    overflow-y: auto;
}
.user-list li {
    padding: 15px 20px;
    border-bottom: 1px solid var(--border-dark);
    font-size: 16px;
    color: var(--text-color);
    cursor: pointer;
    transition: background 0.2s ease;
}
.user-list li:hover {
    background: #333540;
}
.user-list li:last-child {
    border-bottom: none;
}
.user-list::-webkit-scrollbar {
    width: 8px;
}
.user-list::-webkit-scrollbar-track {
    background: #2A2B32;
}
.user-list::-webkit-scrollbar-thumb {
    background: #444754;
    border-radius: 4px;
}
.user-list::-webkit-scrollbar-thumb:hover {
    background: #555;
}




@media (max-width: 600px) {
    .profile-icon {
        width: 35px;
        height: 35px;
    }
    .bottom-sheet-content {
        max-height: 80vh;
    }
    .bottom-sheet-header h3 {
        font-size: 16px;
    }
    .user-list {
        height: 240px;
    }
    .user-list li {
        font-size: 14px;
        padding: 12px 15px;
    }
    .modal-content {
        width: 95%;
        padding: 15px;
    }
    .modal-content h3 {
        font-size: 16px;
    }
    .modal-content p {
        font-size: 14px;
    }
    .modal-actions button {
        padding: 6px 12px;
        font-size: 14px;
    }
    .modal-content select {
        font-size: 14px;
        padding: 6px;
    }
    .remove-user-btn, .edit-user-btn {
    background: #2A2B32; /* Dark background */
    color: white; /* White icon/text by default */
    border: none;
    border-radius: 6px;
    width: 40px;
    height: 40px;
    font-size: 22px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s ease;
    border: 2px solid var(--border-dark);
}

/* Make remove button (X) yellow and dark text */
.remove-user-btn {
    background: #FFC107;
    color: #212121;
}

    .footer-icon img {
        width: 35px;
        height: 35px;
    }
}



.footer {
    z-index: 100;
}





/* Modal Base Styles */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--modal-bg);
    z-index: 1100;
    opacity: 0;
    transition: opacity 0.3s ease-in-out;
}
.modal.show {
    display: block;
    opacity: 1;
}
.modal-content {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #2A2B32;
    border-radius: 12px;
    padding: 20px;
    width: 90%;
    max-width: 400px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
}
.modal-content h3 {
    margin: 0 0 15px;
    font-size: 18px;
    color: var(--text-color);
}
.modal-content p {
    margin: 0 0 15px;
    font-size: 16px;
    color: var(--text-color);
}
.modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}
.modal-actions button {
    padding: 8px 16px;
    border: none;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.2s ease;
}
.modal-actions button:first-child {
    background: #D32F2F;
    color: white;
}
.modal-actions button:first-child:hover {
    background: #B71C1C;
}
.modal-actions button:last-child {
    background: #333;
    color: white;
}
.modal-actions button:last-child:hover {
    background: #333;
}

/* Permission Modal Specific */
.modal-content select {
    width: 100%;
    padding: 8px;
    border-radius: 6px;
    background: #333;
    color: var(--text-color);
    border: 1px solid var(--border-dark);
    margin-bottom: 15px;
    font-size: 16px;
}
#savePermissionBtn {
    background: var(--primary-color);
    color: #212121;
}
#savePermissionBtn:hover {
    background: #FFD54F;
}

/* User List Item Adjustments */
.user-list li {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 20px;
}
.user-list-item {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-grow: 1;
}
.user-list-actions {
    display: flex;
    gap: 8px;
}
.remove-user-btn, .edit-user-btn {
    background: #333540;
    color: var(--primary-color);
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s ease;
}
.edit-user-btn {
    background: #333540;
}
/* Optional hover effects */
.remove-user-btn:hover {
    background: #FFD54F;
}
.edit-user-btn:hover {
    background: #333540;
}



@media (max-width: 600px) {
  .remove-user-btn, .edit-user-btn {
    width: 20px;
    height: 20px;
    font-size: 12px;
  }
}






/* Add User Button in User Selection Modal */
/* Add User Button in User Selection Modal */
/* Add User Button in User Selection Modal */
.add-user-btn {
  background: var(--primary-color);
  color: #212121;
  border: none;
  border-radius: 50%;
  width: 24px;
  height: 24px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transition: background 0.2s ease;
}
.add-user-btn:hover {
  background: #FFD54F;
}

/* Add User Modal */
.add-user-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--modal-bg);
  z-index: 1200;
  opacity: 0;
  transition: opacity 0.3s ease-in-out;
}
.add-user-modal.show {
  display: block;
  opacity: 1;
}
.add-user-modal-content {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #2A2B32;
  border-radius: 12px;
  padding: 20px;
  width: 90%;
  max-width: 400px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
}
.add-user-modal-content h3 {
  margin: 0 0 15px;
  font-size: 18px;
  color: var(--text-color);
}
.add-user-modal-content input {
  width: 100%;
  padding: 8px;
  border-radius: 6px;
  background: #333;
  color: var(--text-color);
  border: 1px solid var(--border-dark);
  margin-bottom: 15px;
  font-size: 16px;
}
.add-user-modal-content .error-message {
  color: #D32F2F;
  font-size: 14px;
  margin-bottom: 10px;
  display: none;
}
.add-user-modal-actions {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}
.add-user-modal-actions button {
  padding: 8px 16px;
  border: none;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.2s ease;
}
.add-user-modal-actions .cancel-btn {
  background: #D32F2F;
  color: white;
}
.add-user-modal-actions .cancel-btn:hover {
  background: #B71C1C;
}
.add-user-modal-actions .submit-btn {
  background: #333;
  color: white;
}
.add-user-modal-actions .submit-btn:hover {
  background: #333;
}

/* Header Title Container for Select User and Add Button */
.header-title {
  display: flex;
  align-items: center;
  gap: 8px;
}

/* Update Bottom Sheet Header for New Layout */
.bottom-sheet-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px 20px;
  border-bottom: 1px solid var(--border-dark);
}

/* Responsive Adjustments */
@media (max-width: 600px) {
  .add-user-btn {
    width: 20px;
    height: 20px;
    font-size: 14px;
  }
  .add-user-modal-content {
    width: 95%;
    padding: 15px;
  }
  .add-user-modal-content h3 {
    font-size: 16px;
  }
  .add-user-modal-content input {
    font-size: 14px;
    padding: 6px;
  }
  .add-user-modal-actions button {
    padding: 6px 12px;
    font-size: 14px;
  }
  .header-title {
    gap: 6px;
  }
}


/* Right top corner Select User Menu ********************************************************/






/* Logout Button ****************************************************/
.logout-container {
    position: fixed;
    top: 10px;
    left: 10px;
    z-index: 150;
}

#logoutBtn {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    background: transparent;
    border: none;
    cursor: pointer;
}

.logout-icon {
    width: 30px;
    height: 30px;
    filter: invert(100%) brightness(150%);
    transition: transform 0.3s ease;
}

.logout-icon:hover {
    transform: scale(1.1);
}

/* Logout Button ****************************************************/






  </style>





</head>
    <body>
        <div class="date-header">
            <img src="/BeeMazing-Y1/mobile/1-Home/ProfileBtn.png" class="profile-icon" id="profileIcon" alt="Select User" />
            <div id="logoutContainer" class="logout-container">
              <button id="logoutBtn" aria-label="Logout" title="Logout">
                  <img src="/BeeMazing-Y1/mobile/1-Home/Logout.png" alt="Logout" class="logout-icon" />
              </button>
          </div>
            <div class="month-nav">
                <button id="prevMonth"><</button>
                <span id="monthLabel">Month</span>
                <button id="nextMonth">></button>
            </div>
            <div class="day-scroll-wrapper">
                <button class="scroll-btn" id="scrollLeft"><</button>
                <div class="day-scroll" id="dayScrollContainer"></div>
                <button class="scroll-btn" id="scrollRight">></button>
            </div>
        </div>

  <div id="taskContainer">Loading tasks...</div>

<!-- User Selection ----------------------------->
<div class="bottom-sheet" id="userSelectModal">
  <div class="bottom-sheet-content">
    <div class="bottom-sheet-header">
      <div class="header-title">
        <h3>Add User</h3>
        <button class="add-user-btn" id="addUserBtn">+</button>
      </div>
      <button id="closeModalBtn" class="close-btn" aria-label="Close"></button>
    </div>
    <ul id="userList" class="user-list"></ul>
  </div>
</div>

<!-- Confirm Delete Modal -->
<div class="modal" id="confirmModal">
  <div class="modal-content">
    <p>Are you sure you want to delete this user?</p>
    <div class="modal-actions">
      <button id="confirmYesBtn">Yes</button>
      <button id="confirmNoBtn">No</button>
    </div>
  </div>
</div>

<!-- Permission Modal -->
<div class="modal" id="permissionModal">
  <div class="modal-content">
    <h3 id="permissionModalUser">Permissions for User</h3>
    <select id="permissionSelect">
      <option value="User">User</option>
      <option value="Admin">Admin</option>
    </select>
    <div class="modal-actions">
      <button id="savePermissionBtn">Save</button>
    </div>
  </div>
</div>

<!-- Add User Modal -->
<div class="add-user-modal" id="addUserModal">
  <div class="add-user-modal-content">
    <h3>Add New User</h3>
    <input type="text" id="usernameInput" placeholder="Enter username" />
    <div class="error-message" id="errorMessage">Please enter a username.</div>
    <div class="add-user-modal-actions">
      <button class="cancel-btn" id="cancelUserBtn">Cancel</button>
      <button class="submit-btn" id="submitUserBtn">Submit</button>
    </div>
  </div>
</div>



<!-- User Selection ----------------------------->

  <div class="footer">
    <a href="#" id="homeButton" class="footer-icon active" aria-label="Home">
        <img src="/BeeMazing-Y1/mobile/1-Home/HomeBtn.png" alt="Home" />
    </a>
    <a href="/BeeMazing-Y1/mobile/3-Tasks/tasks.html" class="footer-icon" aria-label="Tasks">
      <img src="/BeeMazing-Y1/mobile/1-Home/TasksBtn.png" alt="Tasks" />
  </a>
  <a href="/BeeMazing-Y1/mobile/4-Market/market.html" class="footer-icon" aria-label="Market">
      <img src="/BeeMazing-Y1/mobile/1-Home/MarketBtn.png" alt="Market" />
  </a>
</div>



  <script>






// Dynamically set footer button links and active state
// Dynamically set footer button links and active state
const urlParams = new URLSearchParams(window.location.search);
const adminEmail = urlParams.get('admin') || localStorage.getItem('currentAdminEmail') || '';
const userName = urlParams.get('user') || '';
const basePath = '/BeeMazing-Y1/mobile/2-UserProfiles';

const homeButton = document.getElementById('homeButton');
const tasksButton = document.querySelector('a[href="/BeeMazing-Y1/mobile/3-Tasks/tasks.html"]');
const marketButton = document.querySelector('a[href="/BeeMazing-Y1/mobile/4-Market/market.html"]');
if (adminEmail && userName) {
    homeButton.href = `${basePath}/userAdmin.html?admin=${encodeURIComponent(adminEmail)}&user=${encodeURIComponent(userName)}`;
    tasksButton.href = `/BeeMazing-Y1/mobile/3-Tasks/tasks.html?admin=${encodeURIComponent(adminEmail)}&user=${encodeURIComponent(userName)}`;
    marketButton.href = `/BeeMazing-Y1/mobile/4-Market/market.html?admin=${encodeURIComponent(adminEmail)}&user=${encodeURIComponent(userName)}`;
}


// Fetch users from server (adapted from home.js)
async function fetchUsersFromServer(email) {
    try {
        const res = await fetch(`https://beemazing.onrender.com/get-users?adminEmail=${encodeURIComponent(email)}`);
        const data = await res.json();
        if (data.success) {
            const allUserData = JSON.parse(localStorage.getItem("userData")) || {};
            if (!allUserData[email]) {
                allUserData[email] = { users: [], permissions: {} };
            }
            allUserData[email].users = data.users || [];
            allUserData[email].permissions = data.permissions || {};
            localStorage.setItem("userData", JSON.stringify(allUserData));
            return data.users || [];
        }
        return [];
    } catch (err) {
        console.error("Failed to fetch users:", err);
        return [];
    }
}



// User selection ///////////////////////////////////////////////////////////////////////






// Helper function to delete a user from the server
async function deleteUserFromServer(username) {
    try {
        const res = await fetch(
            `https://beemazing.onrender.com/delete-user?adminEmail=${encodeURIComponent(adminEmail)}&username=${encodeURIComponent(username)}`,
            {
                method: "DELETE",
                headers: { "Content-Type": "application/json" }
            }
        );
        const result = await res.json();
        if (result.success) {
            const allUserData = JSON.parse(localStorage.getItem("userData")) || {};
            let users = allUserData[adminEmail]?.users || [];
            users = users.filter(user => user !== username);
            allUserData[adminEmail].users = users;
            localStorage.setItem("userData", JSON.stringify(allUserData));
            return true;
        } else {
            alert("Failed to delete user: " + result.message);
            return false;
        }
    } catch (err) {
        console.error("Failed to delete user:", err);
        alert("Error deleting user. Please try again.");
        return false;
    }
}

// Show confirmation modal for deletion
let userToRemove = null;
function showConfirmModal(username) {
    userToRemove = username;
    document.getElementById("confirmModal").classList.add("show");
}

// Show permission modal for editing
let selectedUserForPermission = null;
function showPermissionModal(username) {
    selectedUserForPermission = username;
    const permissionModalUser = document.getElementById("permissionModalUser");
    const permissionSelect = document.getElementById("permissionSelect");
    permissionModalUser.textContent = `Permissions for ${username}`;
    const allUserData = JSON.parse(localStorage.getItem("userData")) || {};
    const userPermissions = allUserData[adminEmail]?.permissions || {};
    permissionSelect.value = userPermissions[username] || "User";
    document.getElementById("permissionModal").classList.add("show");
}


// Add User Modal Handling
function showAddUserModal() {
  const addUserModal = document.getElementById("addUserModal");
  const usernameInput = document.getElementById("usernameInput");
  const errorMessage = document.getElementById("errorMessage");
  usernameInput.value = "";
  errorMessage.style.display = "none";
  addUserModal.classList.add("show");
}

function closeAddUserModal() {
  const addUserModal = document.getElementById("addUserModal");
  addUserModal.classList.remove("show");
}

document.getElementById("addUserBtn").addEventListener("click", () => {
  showAddUserModal();
});

document.getElementById("addUserModal").addEventListener("click", (e) => {
  if (e.target === document.getElementById("addUserModal")) {
    closeAddUserModal();
  }
});

document.getElementById("cancelUserBtn").addEventListener("click", () => {
  closeAddUserModal();
});

document.getElementById("submitUserBtn").addEventListener("click", async () => {
  const username = document.getElementById("usernameInput").value.trim();
  const errorMessage = document.getElementById("errorMessage");

  if (!username) {
    errorMessage.style.display = "block";
    return;
  }

  if (!adminEmail) {
    alert("Admin email not found. Please log in again.");
    closeAddUserModal();
    return;
  }

  errorMessage.style.display = "none";

  try {
    const res = await fetch("https://beemazing.onrender.com/add-user", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        adminEmail,
        newUser: username
      })
    });

    const result = await res.json();
    if (result.success) {
      // Update localStorage
      const allUserData = JSON.parse(localStorage.getItem("userData")) || {};
      if (!allUserData[adminEmail]) {
        allUserData[adminEmail] = { users: [], permissions: {} };
      }
      allUserData[adminEmail].users.push(username);
      localStorage.setItem("userData", JSON.stringify(allUserData));

      // Refresh user list in modal
      const users = await fetchUsersFromServer(adminEmail);
      const userPermissions = allUserData[adminEmail]?.permissions || {};
      userList.innerHTML = '';
      if (users.length === 0) {
        userList.innerHTML = '<li style="padding: 15px 20px; color: #D32F2F;">No users available</li>';
      } else {
        users.forEach(user => {
          const li = document.createElement("li");
          const nameContainer = document.createElement("div");
          nameContainer.classList.add("user-list-item");
          const userNameSpan = document.createElement("span");
          userNameSpan.textContent = user;
          nameContainer.appendChild(userNameSpan);
          if (userPermissions[user] === "Admin") {
            const checkmark = document.createElement("span");
            checkmark.textContent = "✓";
            checkmark.style.color = "#00C4B4";
            checkmark.style.fontSize = "16px";
            checkmark.style.fontWeight = "bold";
            checkmark.title = "Admin";
            nameContainer.appendChild(checkmark);
          }
          li.appendChild(nameContainer);
          if (isAdmin) {
            const actionsContainer = document.createElement("div");
            actionsContainer.classList.add("user-list-actions");
            const editBtn = document.createElement("button");
            editBtn.classList.add("edit-user-btn");
            editBtn.innerHTML = "⚙️";
            editBtn.addEventListener("click", (event) => {
              event.stopPropagation();
              showPermissionModal(user);
            });
            const removeBtn = document.createElement("button");
            removeBtn.classList.add("remove-user-btn");
            removeBtn.textContent = "X";
            removeBtn.addEventListener("click", (event) => {
              event.stopPropagation();
              showConfirmModal(user);
            });
            actionsContainer.appendChild(editBtn);
            actionsContainer.appendChild(removeBtn);
            li.appendChild(actionsContainer);
          }
          if (user === userName) {
            li.style.background = "#333540";
            li.style.fontWeight = "600";
          }
          li.addEventListener("click", () => {
            const page = userPermissions[user] === "Admin" ? "userAdmin.html" : "users.html";
            window.location.href = `/BeeMazing-Y1/mobile/2-UserProfiles/${page}?admin=${encodeURIComponent(adminEmail)}&user=${encodeURIComponent(user)}`;
          });
          userList.appendChild(li);
        });
      }

      closeAddUserModal();
    } else {
      errorMessage.textContent = result.message || "Failed to add user.";
      errorMessage.style.display = "block";
    }
  } catch (err) {
    console.error("Error adding user:", err);
    errorMessage.textContent = "Error adding user. Please try again.";
    errorMessage.style.display = "block";
  }
});




// User selection
const isAdmin = localStorage.getItem("isAdmin") === "true";
const profileIcon = document.getElementById("profileIcon");
const userSelectModal = document.getElementById("userSelectModal");
const userList = document.getElementById("userList");
const closeModalBtn = document.getElementById("closeModalBtn");
profileIcon.addEventListener("click", async () => {
    if (!adminEmail) {
        alert("Admin email not found. Please log in again.");
        return;
    }
    const users = await fetchUsersFromServer(adminEmail);
    const allUserData = JSON.parse(localStorage.getItem("userData")) || {};
    const userPermissions = allUserData[adminEmail]?.permissions || {};
    userList.innerHTML = '';
    if (users.length === 0) {
        alert("No users found for this admin.");
        userList.innerHTML = '<li style="padding: 15px 20px; color: #D32F2F;">No users available</li>';
    } else {
        users.forEach(user => {
            const li = document.createElement("li");
            const nameContainer = document.createElement("div");
            nameContainer.classList.add("user-list-item");
            const userNameSpan = document.createElement("span");
            userNameSpan.textContent = user;
            nameContainer.appendChild(userNameSpan);
            if (userPermissions[user] === "Admin") {
                const checkmark = document.createElement("span");
                checkmark.textContent = "✓";
                checkmark.style.color = "#00C4B4";
                checkmark.style.fontSize = "16px";
                checkmark.style.fontWeight = "bold";
                checkmark.title = "Admin";
                nameContainer.appendChild(checkmark);
            }
            li.appendChild(nameContainer);
            if (isAdmin) {
                const actionsContainer = document.createElement("div");
                actionsContainer.classList.add("user-list-actions");
                const editBtn = document.createElement("button");
                editBtn.classList.add("edit-user-btn");
                editBtn.innerHTML = "⚙️";
                editBtn.addEventListener("click", (event) => {
                    event.stopPropagation();
                    showPermissionModal(user);
                });
                const removeBtn = document.createElement("button");
                removeBtn.classList.add("remove-user-btn");
                removeBtn.textContent = "X";
                removeBtn.addEventListener("click", (event) => {
                    event.stopPropagation();
                    showConfirmModal(user);
                });
                actionsContainer.appendChild(editBtn);
                actionsContainer.appendChild(removeBtn);
                li.appendChild(actionsContainer);
            }
            if (user === userName) {
                li.style.background = "#333540";
                li.style.fontWeight = "600";
            }
            li.addEventListener("click", () => {
                const page = userPermissions[user] === "Admin" ? "userAdmin.html" : "users.html";
                window.location.href = `/BeeMazing-Y1/mobile/2-UserProfiles/${page}?admin=${encodeURIComponent(adminEmail)}&user=${encodeURIComponent(user)}`;
            });
            userList.appendChild(li);
        });
    }
    userSelectModal.classList.add("show");
});
userSelectModal.addEventListener("click", (e) => {
    if (e.target === userSelectModal) {
        userSelectModal.classList.remove("show");
    }
});
closeModalBtn.addEventListener("click", () => {
    userSelectModal.classList.remove("show");
});

// ConfirmModal event listeners
const confirmModal = document.getElementById("confirmModal");
const confirmYesBtn = document.getElementById("confirmYesBtn");
const confirmNoBtn = document.getElementById("confirmNoBtn");
confirmYesBtn.addEventListener("click", async () => {
    if (userToRemove) {
        const success = await deleteUserFromServer(userToRemove);
        if (success) {
            userToRemove = null;
            confirmModal.classList.remove("show");
            const users = await fetchUsersFromServer(adminEmail);
            userList.innerHTML = '';
            const allUserData = JSON.parse(localStorage.getItem("userData")) || {};
            const userPermissions = allUserData[adminEmail]?.permissions || {};
            users.forEach(user => {
                const li = document.createElement("li");
                const nameContainer = document.createElement("div");
                nameContainer.classList.add("user-list-item");
                const userNameSpan = document.createElement("span");
                userNameSpan.textContent = user;
                nameContainer.appendChild(userNameSpan);
                if (userPermissions[user] === "Admin") {
                    const checkmark = document.createElement("span");
                    checkmark.textContent = "✓";
                    checkmark.style.color = "#00C4B4";
                    checkmark.style.fontSize = "16px";
                    checkmark.style.fontWeight = "bold";
                    checkmark.title = "Admin";
                    nameContainer.appendChild(checkmark);
                }
                li.appendChild(nameContainer);
                if (isAdmin) {
                    const actionsContainer = document.createElement("div");
                    actionsContainer.classList.add("user-list-actions");
                    const editBtn = document.createElement("button");
                    editBtn.classList.add("edit-user-btn");
                    editBtn.innerHTML = "⚙️";
                    editBtn.addEventListener("click", (event) => {
                        event.stopPropagation();
                        showPermissionModal(user);
                    });
                    const removeBtn = document.createElement("button");
                    removeBtn.classList.add("remove-user-btn");
                    removeBtn.textContent = "X";
                    removeBtn.addEventListener("click", (event) => {
                        event.stopPropagation();
                        showConfirmModal(user);
                    });
                    actionsContainer.appendChild(editBtn);
                    actionsContainer.appendChild(removeBtn);
                    li.appendChild(actionsContainer);
                }
                if (user === userName) {
                    li.style.background = "#333540";
                    li.style.fontWeight = "600";
                }
                li.addEventListener("click", () => {
                    const page = userPermissions[user] === "Admin" ? "userAdmin.html" : "users.html";
                    window.location.href = `/BeeMazing-Y1/mobile/2-UserProfiles/${page}?admin=${encodeURIComponent(adminEmail)}&user=${encodeURIComponent(user)}`;
                });
                userList.appendChild(li);
            });
        }
    }
});
confirmNoBtn.addEventListener("click", () => {
    userToRemove = null;
    confirmModal.classList.remove("show");
});
confirmModal.addEventListener("click", (e) => {
    if (e.target === confirmModal) {
        userToRemove = null;
        confirmModal.classList.remove("show");
    }
});

// PermissionModal event listeners
const permissionModal = document.getElementById("permissionModal");
const savePermissionBtn = document.getElementById("savePermissionBtn");
savePermissionBtn.addEventListener("click", async () => {
    const allUserData = JSON.parse(localStorage.getItem("userData")) || {};
    if (!allUserData[adminEmail]) {
        allUserData[adminEmail] = { users: [], permissions: {} };
    }
    if (!allUserData[adminEmail].permissions) {
        allUserData[adminEmail].permissions = {};
    }
    if (selectedUserForPermission) {
        allUserData[adminEmail].permissions[selectedUserForPermission] = document.getElementById("permissionSelect").value;
        localStorage.setItem("userData", JSON.stringify(allUserData));
        try {
            const res = await fetch("https://beemazing.onrender.com/save-permissions", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    adminEmail,
                    permissions: allUserData[adminEmail].permissions
                })
            });
            const result = await res.json();
            if (!result.success) {
                console.warn("Failed to save permissions to server");
            }
        } catch (err) {
            console.error("Error saving permissions:", err);
        }
        permissionModal.classList.remove("show");
        const users = await fetchUsersFromServer(adminEmail);
        userList.innerHTML = '';
        const updatedUserData = JSON.parse(localStorage.getItem("userData")) || {};
        const userPermissions = updatedUserData[adminEmail]?.permissions || {};
        users.forEach(user => {
            const li = document.createElement("li");
            const nameContainer = document.createElement("div");
            nameContainer.classList.add("user-list-item");
            const userNameSpan = document.createElement("span");
            userNameSpan.textContent = user;
            nameContainer.appendChild(userNameSpan);
            if (userPermissions[user] === "Admin") {
                const checkmark = document.createElement("span");
                checkmark.textContent = "✓";
                checkmark.style.color = "#00C4B4";
                checkmark.style.fontSize = "16px";
                checkmark.style.fontWeight = "bold";
                checkmark.title = "Admin";
                nameContainer.appendChild(checkmark);
            }
            li.appendChild(nameContainer);
            if (isAdmin) {
                const actionsContainer = document.createElement("div");
                actionsContainer.classList.add("user-list-actions");
                const editBtn = document.createElement("button");
                editBtn.classList.add("edit-user-btn");
                editBtn.innerHTML = "⚙️";
                editBtn.addEventListener("click", (event) => {
                    event.stopPropagation();
                    showPermissionModal(user);
                });
                const removeBtn = document.createElement("button");
                removeBtn.classList.add("remove-user-btn");
                removeBtn.textContent = "X";
                removeBtn.addEventListener("click", (event) => {
                    event.stopPropagation();
                    showConfirmModal(user);
                });
                actionsContainer.appendChild(editBtn);
                actionsContainer.appendChild(removeBtn);
                li.appendChild(actionsContainer);
            }
            if (user === userName) {
                li.style.background = "#333540";
                li.style.fontWeight = "600";
            }
            li.addEventListener("click", () => {
                const page = userPermissions[user] === "Admin" ? "userAdmin.html" : "users.html";
                window.location.href = `/BeeMazing-Y1/mobile/2-UserProfiles/${page}?admin=${encodeURIComponent(adminEmail)}&user=${encodeURIComponent(user)}`;
            });
            userList.appendChild(li);
        });
    }
});
permissionModal.addEventListener("click", (e) => {
    if (e.target === permissionModal) {
        permissionModal.classList.remove("show");
    }
});


// User selection /////////////////////////////////////////////////////////////////////// 



// Logout Button
const logoutBtn = document.getElementById("logoutBtn");
logoutBtn.addEventListener("click", () => {
    // Only remove login session info
    localStorage.removeItem("isAdmin");
    localStorage.removeItem("userData");
    localStorage.removeItem("adminPassword");
    // Keep currentAdminEmail as per home.js
    window.location.href = "/BeeMazing-Y1/login.html";
});




// Set active state
document.querySelectorAll('.footer a').forEach(link => {
    const currentPath = window.location.pathname.replace(/\/$/, '');
    const linkPath = new URL(link.href, window.location.origin).pathname.replace(/\/$/, '');
    if (currentPath === linkPath) {
        link.classList.add('active');
    } else {
        link.classList.remove('active');
    }
});

 



        let selectedDate = new Date().toLocaleDateString("sv-SE");
let allUsers = [];
const expandedTasks = new Set();


fetchUsersFromServer(adminEmail).then(users => {
    allUsers = users;
    generateScrollableDates();
});



async function updateLuckyChestProgress(userName, earnedHoney) {
  const adminEmail = localStorage.getItem("currentAdminEmail");
  try {
    const response = await fetch(`https://beemazing.onrender.com/api/lucky-chests?adminEmail=${encodeURIComponent(adminEmail)}`);
    const data = await response.json();
    if (!response.ok) throw new Error(data.error || "Failed to fetch lucky chests");
    const allChests = data.luckyChests || {};
    const userChests = allChests[userName] || [];

    let updated = false;

    userChests.forEach(chest => {
      if (chest.progress < chest.requiredPoints) {
        chest.progress += earnedHoney;
        if (chest.progress > chest.requiredPoints) {
          chest.progress = chest.requiredPoints;
        }
        updated = true;
      }
    });

    if (updated) {
      allChests[userName] = userChests;
      await fetch("https://beemazing.onrender.com/api/lucky-chests", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ adminEmail, luckyChests: allChests })
      });
    }
  } catch (err) {
    console.error("Error updating lucky chest progress:", err);
  }
}





// addtasks.html Settings: Rotation //////////////////////////////////////////////////////////////////////////////////////////


async function handleDecision(title, date, index, decision, user, event) {
  try {
    const button = event.target;
    const taskEntry = button.closest(".task-entry");
    const buttons = taskEntry.querySelectorAll("button");
    buttons.forEach(btn => {
      btn.disabled = true;
      btn.style.opacity = "0.5";
    });

    const response = await fetch("https://beemazing.onrender.com/api/review-task", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        adminEmail,
        title,
        date,
        selectedDate,
        user,
        decision
      })
    });

    const data = await response.json();
    if (!response.ok) throw new Error(data.error || "Failed to process decision");

    // If task is accepted, update Lucky Chest progress
    if (decision === "accept" && data.rewardAmount > 0) {
      await updateLuckyChestProgress(user, data.rewardAmount);
    }

    setTimeout(() => loadTasks(), 500);
  } catch (err) {
    console.error("Error processing decision:", err);
    const errorDiv = document.createElement("div");
    errorDiv.style.color = "red";
    errorDiv.textContent = `Error: ${err.message}`;
    taskEntry.appendChild(errorDiv);
    taskEntry.querySelectorAll("button").forEach(btn => {
      btn.disabled = false;
      btn.style.opacity = "1";
    });
    setTimeout(() => errorDiv.remove(), 3000);
  }
}







async function handleReplace(title, date, index, user, event) {
  const taskEntry = event.target.closest(".task-entry");
  const select = taskEntry.querySelector(`#replace-select-${index}`);
  const newUser = select.value;

  // Validate new user
  if (!newUser || newUser === user) {
    const errorDiv = document.createElement("div");
    errorDiv.style.color = "red";
    errorDiv.textContent = "Please select a different user.";
    taskEntry.appendChild(errorDiv);
    setTimeout(() => errorDiv.remove(), 3000);
    return;
  }
  if (!allUsers.includes(newUser)) {
    const errorDiv = document.createElement("div");
    errorDiv.style.color = "red";
    errorDiv.textContent = "Invalid user selected.";
    taskEntry.appendChild(errorDiv);
    setTimeout(() => errorDiv.remove(), 3000);
    return;
  }

  try {
    const response = await fetch("https://beemazing.onrender.com/api/replace-user", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        adminEmail,
        title,
        date,
        selectedDate,
        index: parseInt(index),
        originalUser: user,
        newUser
      })
    });

    const data = await response.json();
    if (!response.ok) throw new Error(data.error || "Failed to replace user");

    // Update UI only after server confirmation
    const turnEntry = taskEntry.querySelector(`.turn-entry[data-index="${index}"]`);
    turnEntry.querySelector("p").textContent = `Turn ${parseInt(index) + 1}: ${newUser} - Pending`;
    turnEntry.querySelector("select").value = "";
    turnEntry.dataset.user = newUser;
    setTimeout(() => loadTasks(), 500);
  } catch (err) {
    console.error("Error replacing user:", err);
    const errorDiv = document.createElement("div");
    errorDiv.style.color = "red";
    errorDiv.textContent = `Error: ${err.message}`;
    taskEntry.appendChild(errorDiv);
    setTimeout(() => errorDiv.remove(), 3000);
  }
}


// addtasks.html Settings: Rotation //////////////////////////////////////////////////////////////////////////////////////////


//--

async function handleRevert(title, date, index, user, event) {
  try {
    const button = event.target;
    const taskEntry = button.closest(".task-entry");
    const buttons = taskEntry.querySelectorAll("button");
    buttons.forEach(btn => {
      btn.disabled = true;
      btn.style.opacity = "0.5";
    });

    const response = await fetch("https://beemazing.onrender.com/api/revert-decision", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        adminEmail,
        title,
        date,
        selectedDate,
        user
      })
    });

    const data = await response.json();
    if (!response.ok) throw new Error(data.error || "Failed to revert decision");

    setTimeout(() => loadTasks(), 500);
  } catch (err) {
    console.error("Error reverting decision:", err);
    const errorDiv = document.createElement("div");
    errorDiv.style.color = "red";
    errorDiv.textContent = `Error: ${err.message}`;
    taskEntry.appendChild(errorDiv);
    taskEntry.querySelectorAll("button").forEach(btn => {
      btn.disabled = false;
      btn.style.opacity = "1";
    });
    setTimeout(() => errorDiv.remove(), 3000);
  }
}

//---


// addtasks.html Settings: Rotation //////////////////////////////////////////////////////////////////////////////////////////

async function loadTasks() {
  try {
    const res = await fetch(`https://beemazing.onrender.com/get-tasks?adminEmail=${encodeURIComponent(adminEmail)}&t=${Date.now()}`, {
      cache: "no-store"
    });
    if (!res.ok) throw new Error(`HTTP error ${res.status}`);
    const { tasks } = await res.json();

    // Filter tasks using filterTasksForDate from taskrotations.js
    const filteredTasks = filterTasksForDate(tasks, selectedDate);

    const container = document.getElementById("taskContainer");
    container.innerHTML = ""; // Clear UI

    if (filteredTasks.length === 0) {
      container.innerHTML = "<p>No tasks for this date.</p>";
      return;
    }

    filteredTasks.forEach(task => {
      if (!task.title || !task.users || !task.date) {
        console.warn(`Skipping invalid task:`, task);
        return;
      }

      let turnData;
      if (task.settings?.includes("Rotation")) {
        if (typeof mixedTurnData !== 'function') {
          console.error(`mixedTurnData is not defined for task: ${task.title}`);
          turnData = { turns: [], completedCount: 0, requiredTimes: 1 };
        } else {
          turnData = mixedTurnData(task, selectedDate);
        }
      } else if (task.settings?.includes("Individual")) {
        if (typeof individualTurnData !== 'function') {
          console.error(`individualTurnData is not defined for task: ${task.title}`);
          turnData = { turns: [], completedCount: 0, requiredTimes: 1 };
        } else {
          turnData = individualTurnData(task, selectedDate);
        }
      } else {
        console.warn(`Unsupported task settings for ${task.title}: ${task.settings}`);
        turnData = { turns: [], completedCount: 0, requiredTimes: 1 };
      }

      const pendingCount = turnData.turns.filter(t => t.isPending).length;
      const div = document.createElement("div");
      div.className = "task-entry";
      div.dataset.title = task.title;
      div.dataset.date = task.date;
      div.innerHTML = `
        <h3 class="task-title">${task.title}${pendingCount > 0 ? `<span class="notification-bubble">${pendingCount}</span>` : ''}</h3>
        <div class="task-details${expandedTasks.has(task.title) ? ' show' : ''}">
          ${
            turnData.turns.length && turnData.turns[0].repetition !== undefined && turnData.turns[0].user !== undefined
              ? (task.settings.includes("Rotation")
                ? turnData.turns.map(turn => `
                  <div class="turn-entry" data-index="${turn.index}" data-user="${turn.user}">
                    <p>Turn ${turn.index + 1}: ${turn.user} - ${turn.isCompleted ? 'Accepted' : turn.isPending ? 'Waiting for Review' : 'Pending'}</p>
                    ${turn.isPending && !turn.isCompleted ? `
                      <button class="accept-btn" onclick="handleDecision('${task.title}', '${task.date}', ${turn.index}, 'accept', '${turn.user}', event)">Accept</button>
                      <button class="decline-btn" onclick="handleDecision('${task.title}', '${task.date}', ${turn.index}, 'decline', '${turn.user}', event)">Decline</button>
                    ` : turn.isCompleted ? `
                      <button class="revert-btn" onclick="handleRevert('${task.title}', '${task.date}', ${turn.index}, '${turn.user}', event)">Revert</button>
                    ` : `
                      <select id="replace-select-${turn.index}">
                        <option value="">Select User</option>
                        ${allUsers.map(u => `<option value="${u}">${u}</option>`).join('')}
                      </select>
                      <button class="replace-btn" onclick="handleReplace('${task.title}', '${task.date}', ${turn.index}, '${turn.user}', event)">Replace</button>
                    `}
                  </div>
                `).join('')
                : task.users.map(user => {
                    const userTurns = turnData.turns.filter(t => t.user === user);
                    return `
                      <h4 style="margin-top: 10px;">${user}</h4>
                      ${userTurns.map(turn => `
                        <div class="turn-entry" draggable="false" data-index="${turn.index}" data-user="${turn.user}">
                          <p>Attempt ${turn.repetition}: ${turn.isCompleted ? 'Accepted' : turn.isPending ? 'Waiting for Review' : 'Pending'}</p>
                          ${turn.isPending && !turn.isCompleted ? `
                            <button class="accept-btn" onclick="handleDecision('${task.title}', '${task.date}', ${turn.index}, 'accept', '${turn.user}', event)">Accept</button>
                            <button class="decline-btn" onclick="handleDecision('${task.title}', '${task.date}', ${turn.index}, 'decline', '${turn.user}', event)">Decline</button>
                          ` : turn.isCompleted ? `
                            <button class="revert-btn" onclick="handleRevert('${task.title}', '${task.date}', ${turn.index}, '${turn.user}', event)">Revert</button>
                          ` : `
                            <select id="replace-select-${turn.index}">
                              <option value="">Select User</option>
                              ${allUsers.map(u => `<option value="${u}">${u}</option>`).join('')}
                            </select>
                            <button class="replace-btn" onclick="handleReplace('${task.title}', '${task.date}', ${turn.index}, '${turn.user}', event)">Replace</button>
                          `}
                        </div>
                      `).join('')}
                    `;
                  }).join(''))
              : '<p>No turns assigned.</p>'
          }
        </div>
      `;
      container.appendChild(div);

      div.querySelector(".task-title").addEventListener("click", () => {
        const details = div.querySelector(".task-details");
        details.classList.toggle("show");
        if (details.classList.contains("show")) {
          expandedTasks.add(task.title);
        } else {
          expandedTasks.delete(task.title);
        }
      });
    });
  } catch (err) {
    console.error("Error loading tasks:", err);
    document.getElementById("taskContainer").innerHTML = "<p>Error loading tasks. Please try again.</p>";
  }
}



// addtasks.html Settings: Rotation //////////////////////////////////////////////////////////////////////////////////////////









function generateScrollableDates(monthOffset = 0) {
  const container = document.getElementById("dayScrollContainer");
  container.innerHTML = "";

  const today = new Date();
  today.setDate(1);
  today.setMonth(today.getMonth() + monthOffset);

  const currentMonth = today.getMonth();
  const currentYear = today.getFullYear();
  const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

  document.getElementById("monthLabel").textContent = today.toLocaleDateString(undefined, {
    month: 'long',
    year: 'numeric',
  });

  const todayStr = new Date().toLocaleDateString("sv-SE");

  for (let i = 1; i <= daysInMonth; i++) {
    const date = new Date(currentYear, currentMonth, i);
    const btn = document.createElement("div");
    btn.className = "day";
    btn.textContent = i;
    btn.dataset.date = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;

    btn.addEventListener("click", () => {
  document.querySelectorAll(".day").forEach(d => d.classList.remove("selected"));
  btn.classList.add("selected");
  selectedDate = btn.dataset.date;
  loadTasks();
});

    if (btn.dataset.date === todayStr) {
  btn.classList.add("selected");
  selectedDate = btn.dataset.date;
  loadTasks();
}

    container.appendChild(btn);
  }

  setTimeout(() => {
    const selected = document.querySelector(".day.selected");
    if (selected) {
      selected.scrollIntoView({ behavior: "smooth", inline: "center" });
    }
  }, 50);
}















let monthOffset = 0;
document.getElementById("prevMonth").addEventListener("click", () => {
  monthOffset--;
  generateScrollableDates(monthOffset);
});
document.getElementById("nextMonth").addEventListener("click", () => {
  monthOffset++;
  generateScrollableDates(monthOffset);
});
document.getElementById("scrollLeft").addEventListener("click", () => {
  document.getElementById("dayScrollContainer").scrollBy({
    left: -200,
    behavior: "smooth",
  });
});
document.getElementById("scrollRight").addEventListener("click", () => {
  document.getElementById("dayScrollContainer").scrollBy({
    left: 200,
    behavior: "smooth",
  });
});



  </script>



<script src="/BeeMazing-Y1/shared/taskrotations.js?t=${Date.now()}"></script>






</body>
</html>